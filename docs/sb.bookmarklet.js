javascript: (function () {const categories=["sponsor","selfpromo","interaction","intro","outro","preview","music_offtopic","exclusive_access","poi_highlight"],actionTypes=["skip","mute","full","poi"],skipThreshold=[.2,1],serverEndpoint="https://sponsor.ajay.app",skipTracking=!0,highlightKey="Enter",VERSION="1.2.2";let video,videoID,skipSegments,muteSegments,muteEndTime,videoLabel,poiLabel;const getVideoID=()=>new URL(window.location.href).searchParams.get("v");function getJSON(e,t){const i=new XMLHttpRequest;i.open("GET",e),i.responseType="json",i.onload=()=>200==i.status?t(null,i.response):t(i.status),i.send()}function trackSkip(e){if(skipTracking){e=serverEndpoint+"/api/viewedVideoSponsorTime?UUID="+e;const t=new XMLHttpRequest;t.open("POST",e),t.send()}}function fetch(e){if(!video)return console.log("[SB.js] no video");getJSON(`${serverEndpoint}/api/skipSegments?videoID=${e}&categories=${JSON.stringify(categories)}&actionTypes=`+JSON.stringify(actionTypes),(e,t)=>{if(e)return console.error("[SB.js]","error fetching segments",e);if(skipSegments=new Map(t.filter(e=>"skip"===e.actionType).map(e=>[e.segment[0],{end:e.segment[1],uuid:e.UUID}])),muteSegments=new Map(t.filter(e=>"mute"===e.actionType).map(e=>[e.segment[0],{end:e.segment[1],uuid:e.UUID}])),createVideoLabel(videoLabel=t.filter(e=>"full"===e.actionType)),(poiLabel=t.filter(e=>"poi"===e.actionType)).length){createVideoLabel(poiLabel,"poi");const i=e=>{if(e.key===highlightKey){video.currentTime=poiLabel[0].segment[1],trackSkip(poiLabel[0].UUID);const t=document.querySelector("#sbjs-label-poi");t.style.display="none",document.removeEventListener("keydown",i)}};document.addEventListener("keydown",i)}}),console.log("[SB.js] Loaded Segments")}function skipOrMute(){var e=video.currentTime,t=(video.muted&&e>=muteEndTime&&(video.muted=!1,muteEndTime=0),findEndTime(e,skipSegments)),t=(t&&(video.currentTime=t),findEndTime(e,muteSegments));t&&(video.muted=!0,muteEndTime=t)}function findEndTime(e,t){let i=null;for(const s of t.keys())if(e+skipThreshold[0]>=s&&e-s<=skipThreshold[1]){var o,n=t.get(s);i=n.end,trackSkip(n.uuid),t.delete(s);for(const r of t.keys())i>=r&&r>=e&&(o=t.get(r),i=o.end,trackSkip(o.uuid),t.delete(r));return i}return i}function createVideoLabel(e,t="full"){if(e.length){const n=document.querySelector("#title h1, h1.title.ytd-video-primary-info-renderer");if(n){var i=e[0].category,o=e=>`The entire video is ${e} and is too tightly integrated to be able to seperate`,o={sponsor:["#0d0","#111",o("sponsor")],selfpromo:["#ff0","#fff",o("selfpromo")],exclusive_access:["#085","#fff","This video showcases a product, service or location that they've received free or subsidized access to"],poi_highlight:["#f18","#fff",`Press ${highlightKey} to skip to the highlight`]}[i];const s=document.createElement("span");s.title=o[2],s.innerText=i,s.id="sbjs-label-"+t,s.style=`color: ${o[1]}; background-color: ${o[0]}; display: flex; margin: 0 5px;`,n.style="display: flex;",n.prepend(s)}else setTimeout(createVideoLabel,200,e)}}const reset=()=>{video=void 0,videoID=void 0,muteEndTime=0,videoLabel=void 0,skipSegments=[],muteSegments=[],videoLabel=[],poiLabel=[]};function setup(){if(videoID!==getVideoID()){if(console.log(`@mchangrh/SB.js ${VERSION} Loaded`),console.log("Uses SponsorBlock data licensed used under CC BY-NC-SA 4.0 from https://sponsor.ajay.app/"),document.querySelector("#previewbar"))return console.log("[SB.js] Extension Present, Exiting");video=document.querySelector("video"),fetch(videoID=getVideoID()),video.addEventListener("timeupdate",skipOrMute)}}document.addEventListener("yt-navigate-start",reset),document.addEventListener("yt-navigate-finish",setup),setup();})()